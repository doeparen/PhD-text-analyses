---
title: "text2vec"
author: "Josef Ginnerskov"
date: "9/14/2021"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Read xml, create corpus and handle metadata
```{r}
library(tm)
library(xml2)
setwd("~/Documents/Text mining/Avhandlingar/Project files/All full-text/TranslatedALLtxt")
allxml <- list.files(pattern = "\\.xml$")

spec <- list(
     id = list("node", "id"),
     year = list("node", "year"),
     uni = list("node", "uni"),
     author = list("node", "author"),
     language = list ("node", "language"),
     disstype = list ("node", "disstype"),
     gender = list("node", "gender"),
     content = list("node", "text"))

myXMLReader <- readXML(
   spec = spec,
   doc = PlainTextDocument())

children <- function(x)
  xml2::xml_children(xml2::xml_children(x))

mySource <- function(x)
  XMLSource(x, parser = children, reader = myXMLReader)

print(allxml[1])

allmaincorp <- VCorpus(mySource(allxml[1]),
                   readerControl = list(reader = myXMLReader))

inspect(allmaincorp)
attributes(allmaincorp)
meta(allmaincorp)
summary(allmaincorp$meta)

allmaincorp_meta <- list()

for (name in names(spec)) {
  allmaincorp_meta <- cbind(allmaincorp_meta, meta(allmaincorp, name))
}

colnames(allmaincorp_meta) <- names(spec)
print(as.data.frame(allmaincorp_meta))
class(allmaincorp_meta)

allmaincorp_meta

```


## Prune corpus and cast to tidy
```{r}
library(tidyverse)
library(tidytext)
# original prune
allmaincorp_map <- tm_map(allmaincorp, removePunctuation)
allmaincorp_map <- tm_map(allmaincorp_map, removeNumbers)
allmaincorp_map <- tm_map(allmaincorp_map, content_transformer(tolower))
allmaincorp_map <- tm_map(allmaincorp_map, stripWhitespace)

tidy_allmain <- tidy(allmaincorp) #original corpus
tidy_allmain_map <- tidy(allmaincorp_map) #original corpus minus uppercase/punctuation/numbers/whitespace
x <- tolower(tidy_allmain_map$text)
y <- tolower(tidy_allmain$text)
```

# General corpus stats
```{r}
tokens_tidy_map <- tidy_allmain_map %>%
  unnest_tokens(word, text)

book_words <- tokens_tidy_map %>%
  count(id, word, sort = TRUE)

total_words <- book_words %>% 
  group_by(id) %>% 
  summarize(total = sum(n))

book_words <- left_join(book_words, total_words)

order(book_words$total, decreasing = T)


book_words %>%
  tail(n=100)

```


## prepare for stylo-based post-Gephi analysis
```{r}
stylo_df <- read_csv("stylo_gephi.csv")

stylo_df <- arrange(stylo_df, id)

tidy_allmain_stylo <- tidy_allmain[-39, ]
tidy_allmain_stylo <- arrange(tidy_allmain_stylo, uni, author)

tidy_allmain_stylo$modularity_class <- stylo_df$modularity_class

tidy_allmain_stylo_token <- tidy_allmain_stylo %>%
  unnest_tokens(word, text) %>%
  anti_join(stop_words)
```


## CBOW word2vec model - 50 dim
```{r}
library(word2vec)
#CBOW
set.seed(123456789)
model_cbow <- word2vec(x = x, type = "cbow", dim = 50, iter = 20, threads = 8, min_count = 3, window = 8)
embedding_cbow <- as.matrix(model_cbow)
embedding_cbow <- predict(model_cbow, c("methodological", "health"), type = "embedding")
lookslike <- predict(model_cbow, c("methodological", "health"), type = "nearest", top_n = 5)
lookslike
```

## Skip-gram word2vec model - 50 dim
```{r}
library(word2vec)
#skip-gram
set.seed(123456789)
model_skip <- word2vec(x = x, type = "skip-gram", dim = 50, iter = 20, threads = 8, min_count = 3L, window = 8L)
embedding_skip <- as.matrix(model_skip)
embedding_skip <- predict(model_skip, c("methodological", "health"), type = "embedding")
lookslike <- predict(model_skip, c("methodological", "health"), type = "nearest", top_n = 5)
lookslike
```

## GloVe model - 50 dim
```{r}
library(text2vec)
tokens <- space_tokenizer(x)
it = itoken(tokens, progressbar = TRUE)
vocab <- create_vocabulary(it) # use uni-grams
vocab <- prune_vocabulary(vocab, term_count_min = 3L)
vectorizer <- vocab_vectorizer(vocab)

# Create a Term-Count-Matrix, by default it will use a skipgram window of 8 (symmetrical)
tcm <- create_tcm(it, vectorizer, skip_grams_window = 8L)
tcm

# maximum number of co-occurrences to use in the weighting function, we choose the entire token set divided by 100
x_max <- length(vocab$doc_count)/100

# set up the embedding matrix and fit model
glove_model <- GloVe$new(rank = 50, x_max = x_max) # rank sets number of dimensions (i.e "dim" in word2vec)
glove_embedding = glove_model$fit_transform(tcm, n_iter = 20, convergence_tol = 0.01, n_threads = 8)


# combine main embedding and context embeddings (sum) into one matrix
glove_embedding = glove_embedding + t(glove_model$components) # the transpose of the context matrix
```

## CBOW word2vec model - 300 dim fix
```{r}
library(word2vec)
#CBOW
set.seed(123456789)
model_cbow300fix <- word2vec(x = x, type = "cbow", dim = 300, iter = 20, threads = 8, min_count = 3, window = 8)
embedding_cbow300fix <- as.matrix(model_cbow300fix)
itsembeddings <- predict(embedding_cbow300fix, c("methodological", "health"), type = "embedding")
lookslike <- predict(embedding_cbow300fix, c("methodological", "sociology"), type = "nearest", top_n = 5)
lookslike
itsembeddings
```

## Skip-gram word2vec model - 300 dim fix
```{r}
library(word2vec)
#skip-gram
set.seed(123456789)
model_skip300fix <- word2vec(x = x, type = "skip-gram", dim = 300, iter = 20, threads = 8, min_count = 3L, window = 8L)
embedding_skip300fix <- as.matrix(model_skip300fix)
itsembeddings <- predict(model_skip300, c("methodological", "health"), type = "embedding")
lookslike <- predict(model_skip300, c("methodological", "sociology"), type = "nearest", top_n = 5)
lookslike
```

## GloVe model - 300 dim fix
```{r}
library(text2vec)
tokens <- space_tokenizer(x)
it = itoken(tokens, progressbar = TRUE)
vocab <- create_vocabulary(it) # use uni-grams
vocab <- prune_vocabulary(vocab, term_count_min = 3L)
vectorizer <- vocab_vectorizer(vocab)

# Create a Term-Count-Matrix, by default it will use a skipgram window of 8 (symmetrical)
tcm <- create_tcm(it, vectorizer, skip_grams_window = 8L)
tcm

# maximum number of co-occurrences to use in the weighting function, we choose the entire token set divided by 100
x_max <- length(vocab$doc_count)/100

# set up the embedding matrix and fit model
glove_model300 <- GloVe$new(rank = 300, x_max = x_max) # rank sets number of dimensions (i.e "dim" in word2vec)
glove_embedding300 = glove_model300$fit_transform(tcm, n_iter = 20, convergence_tol = 0.01, n_threads = 8)


# combine main embedding and context embeddings (sum) into one matrix
glove_embedding300 = glove_embedding300 + t(glove_model300$components) # the transpose of the context matrix
```


setwd("~/Documents/Text mining/Avhandlingar/Project files/All full-text/TranslatedALLtxt")

## Save the models
```{r}
setwd("~/Documents/Text mining/Avhandlingar/Project files/All full-text/TranslatedALLtxt")
# Write 50 dimensions
write.word2vec(model_cbow, "mymodel_cbow.bin")
write.word2vec(model_skip, "mymodel_skip.bin")
save(glove_embedding, file = "glove_embedding.RData")

# Write 300 dimensions
write.word2vec(model_cbow300, "mymodel_cbow300.bin")
write.word2vec(model_skip300, "mymodel_skip300.bin")
save(glove_embedding300, file = "glove_embedding300.RData")

# Write 300 dimensions fixed (2007 LU Lundberg on philosophy; added Sandra)

write.word2vec(model_cbow300fix, "mymodel_cbow300fix.bin")
write.word2vec(model_skip300fix, "mymodel_skip300fix.bin")
save(glove_embedding300, file = "glove_embedding300.RData")

```

## Load the models for analysis
```{r}
# Load all packages needed for analysis
library(text2vec)
library(word2vec)
library(tidyverse)
library(tidytext)
library(tm)

# Locate the right directory
setwd("~/Documents/Text mining/Avhandlingar/Project files/All full-text/TranslatedALLtxt")

# Read CBOW 50
model_cbow <- read.word2vec("mymodel_cbow.bin")
terms_cbow <- summary(model_cbow, "vocabulary")
embedding_cbow <- as.matrix(model_cbow)

# Read skip-gram 50
model_skip <- read.word2vec("mymodel_skip.bin")
terms_skip <- summary(model_skip, "vocabulary")
embedding_skip <- as.matrix(model_skip)

# Read GloVe 50
load("glove_embedding.RData")

# Read CBOW 300
model_cbow300 <- read.word2vec("mymodel_cbow300.bin")
terms_cbow300 <- summary(model_cbow300, "vocabulary")
embedding_cbow300 <- as.matrix(model_cbow300)

# Read skip-gram 300
model_skip300 <- read.word2vec("mymodel_skip300fix.bin")
terms_skip300 <- summary(model_skip300, "vocabulary")
embedding_skip300 <- as.matrix(model_skip300)

# Read GloVe 300
load("glove_embedding300.RData")

# Read CBOW 300 fix
model_cbow300fix <- read.word2vec("mymodel_cbow300fix.bin")
model_cbow300fix <- summary(model_cbow300fix, "vocabulary")
embedding_cbow300fix <- as.matrix(model_cbow300fix)


# Read skip-gram 300 fix
model_skip300fix <- read.word2vec("mymodel_skip300fix.bin")
terms_skip300fix <- summary(model_skip300fix, "vocabulary")
embedding_skip300fix <- as.matrix(model_skip300fix)
```

## Utilize the word embedding model

```{r}
library(text2vec)
# Utilize the skip gram model 300 fix
cos_sim = sim2(x = embedding_skip300fix, y = embedding_skip300fix["economy", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(cos_sim[,1], decreasing = TRUE), 20)

abc <- embedding_skip300fix["mead", , drop = FALSE]
cos_sim = sim2(x = embedding_skip300fix, y = abc, method = "cosine", norm = "l2")
head(sort(cos_sim[,1], decreasing = TRUE), 20)

abc <- embedding_skip300fix["sociology", , drop = FALSE] - 
  embedding_skip300fix["research", , drop = FALSE]
cos_sim = sim2(x = embedding_skip300fix, y = abc, method = "cosine", norm = "l2")
head(sort(cos_sim[,1], decreasing = TRUE), 30)
```
```{r}
library(text2vec)
# Utilize the GloVe model 300
cos_sim = sim2(x = embedding_skip300fix, y = embedding_skip300fix["society", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(cos_sim[,1], decreasing = TRUE), 10)

abc <- embedding_skip300fix["mead", , drop = FALSE]
cos_sim = sim2(x = embedding_skip300fix, y = abc, method = "cosine", norm = "l2")
head(sort(cos_sim[,1], decreasing = TRUE), 20)

abc <- embedding_skip300fix["sociology", , drop = FALSE] - 
  embedding_skip300fix["research", , drop = FALSE]
cos_sim = sim2(x = embedding_skip300fix, y = abc, method = "cosine", norm = "l2")
head(sort(cos_sim[,1], decreasing = TRUE), 30)
```

# SOCIETY + INDIVIDUAL
```{r}
#Export to excel
library(text2vec)
library(reshape2)
library(writexl)

# SOCIETY
society = sim2(x = embedding_skip300fix, y = embedding_skip300fix["society", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(society[,1], decreasing = TRUE), 21)
society <- sort(society[,1], decreasing = TRUE)
society <- as.data.frame( as.table(society))
society <- society[1:50,]
write_xlsx(society, "society.xlsx")

economy = sim2(x = embedding_skip300fix, y = embedding_skip300fix["economy", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(economy[,1], decreasing = TRUE), 21)
economy <- sort(economy[,1], decreasing = TRUE)
economy <- as.data.frame( as.table(economy))
economy <- economy[1:50,]
write_xlsx(economy, "economy.xlsx")

societies = sim2(x = embedding_skip300fix, y = embedding_skip300fix["societies", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(societies[,1], decreasing = TRUE), 21)
societies <- sort(societies[,1], decreasing = TRUE)
societies <- as.data.frame( as.table(societies))
societies <- societies[1:50,]
write_xlsx(societies, "societies.xlsx")

modern = sim2(x = embedding_skip300fix, y = embedding_skip300fix["modern", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(modern[,1], decreasing = TRUE), 21)
modern <- sort(modern[,1], decreasing = TRUE)
modern <- as.data.frame( as.table(modern))
modern <- modern[1:50,]
write_xlsx(modern, "modern.xlsx")

culture = sim2(x = embedding_skip300fix, y = embedding_skip300fix["culture", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(culture[,1], decreasing = TRUE), 21)
culture <- sort(culture[,1], decreasing = TRUE)
culture <- as.data.frame( as.table(culture))
culture <- culture[1:50,]
write_xlsx(culture, "culture.xlsx")

state = sim2(x = embedding_skip300fix, y = embedding_skip300fix["state", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(state[,1], decreasing = TRUE), 21)
state <- sort(state[,1], decreasing = TRUE)
state <- as.data.frame( as.table(state))
state <- state[1:50,]
write_xlsx(state, "state.xlsx")

# bigger society




modernity = sim2(x = embedding_skip300fix, y = embedding_skip300fix["modernity", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(modernity[,1], decreasing = TRUE), 21)
modernity <- sort(modernity[,1], decreasing = TRUE)
modernity <- as.data.frame( as.table(modernity))
modernity <- modernity[1:50,]
write_xlsx(modernity, "modernity.xlsx")

late = sim2(x = embedding_skip300fix, y = embedding_skip300fix["late", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(late[,1], decreasing = TRUE), 21)
late <- sort(late[,1], decreasing = TRUE)
late <- as.data.frame( as.table(late))
late <- late[1:50,]
write_xlsx(late, "late.xlsx")

contemporary = sim2(x = embedding_skip300fix, y = embedding_skip300fix["contemporary", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(contemporary[,1], decreasing = TRUE), 21)
contemporary <- sort(contemporary[,1], decreasing = TRUE)
contemporary <- as.data.frame( as.table(contemporary))
contemporary <- contemporary[1:50,]
write_xlsx(contemporary, "contemporary.xlsx")

western = sim2(x = embedding_skip300fix, y = embedding_skip300fix["western", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(western[,1], decreasing = TRUE), 21)
western <- sort(western[,1], decreasing = TRUE)
western <- as.data.frame( as.table(western))
western <- western[1:50,]
write_xlsx(western, "western.xlsx")

premodern = sim2(x = embedding_skip300fix, y = embedding_skip300fix["premodern", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(premodern[,1], decreasing = TRUE), 21)
premodern <- sort(premodern[,1], decreasing = TRUE)
premodern <- as.data.frame( as.table(premodern))
premodern <- premodern[1:50,]
write_xlsx(premodern, "premodern.xlsx")

industrialized = sim2(x = embedding_skip300fix, y = embedding_skip300fix["industrialized", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(industrialized[,1], decreasing = TRUE), 21)
industrialized <- sort(industrialized[,1], decreasing = TRUE)
industrialized <- as.data.frame( as.table(industrialized))
industrialized <- industrialized[1:50,]
write_xlsx(industrialized, "industrialized.xlsx")

economies = sim2(x = embedding_skip300fix, y = embedding_skip300fix["economies", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(economies[,1], decreasing = TRUE), 21)
economies <- sort(economies[,1], decreasing = TRUE)
economies <- as.data.frame( as.table(economies))
economies <- economies[1:50,]
write_xlsx(economies, "economies.xlsx")

cultural = sim2(x = embedding_skip300fix, y = embedding_skip300fix["cultural", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(cultural[,1], decreasing = TRUE), 21)
cultural <- sort(cultural[,1], decreasing = TRUE)
cultural <- as.data.frame( as.table(cultural))
cultural <- cultural[1:50,]
write_xlsx(cultural, "cultural.xlsx")

cultures = sim2(x = embedding_skip300fix, y = embedding_skip300fix["cultures", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(cultures[,1], decreasing = TRUE), 21)
cultures <- sort(cultures[,1], decreasing = TRUE)
cultures <- as.data.frame( as.table(cultures))
cultures <- cultures[1:50,]
write_xlsx(cultures, "cultures.xlsx")

popular = sim2(x = embedding_skip300fix, y = embedding_skip300fix["popular", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(popular[,1], decreasing = TRUE), 21)
popular <- sort(popular[,1], decreasing = TRUE)
popular <- as.data.frame( as.table(popular))
popular <- popular[1:50,]
write_xlsx(popular, "popular.xlsx")

language = sim2(x = embedding_skip300fix, y = embedding_skip300fix["language", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(language[,1], decreasing = TRUE), 21)
language <- sort(language[,1], decreasing = TRUE)
language <- as.data.frame( as.table(language))
language <- language[1:50,]
write_xlsx(language, "language.xlsx")

religion = sim2(x = embedding_skip300fix, y = embedding_skip300fix["religion", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(religion[,1], decreasing = TRUE), 21)
religion <- sort(religion[,1], decreasing = TRUE)
religion <- as.data.frame( as.table(religion))
religion <- religion[1:50,]
write_xlsx(religion, "religion.xlsx")

government = sim2(x = embedding_skip300fix, y = embedding_skip300fix["government", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(government[,1], decreasing = TRUE), 21)
government <- sort(government[,1], decreasing = TRUE)
government <- as.data.frame( as.table(government))
government <- government[1:50,]
write_xlsx(government, "government.xlsx")

welfare = sim2(x = embedding_skip300fix, y = embedding_skip300fix["welfare", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(welfare[,1], decreasing = TRUE), 21)
welfare <- sort(welfare[,1], decreasing = TRUE)
welfare <- as.data.frame( as.table(welfare))
welfare <- welfare[1:50,]
write_xlsx(welfare, "welfare.xlsx")

states = sim2(x = embedding_skip300fix, y = embedding_skip300fix["states", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(states[,1], decreasing = TRUE), 21)
states <- sort(states[,1], decreasing = TRUE)
states <- as.data.frame( as.table(states))
states <- states[1:50,]
write_xlsx(states, "states.xlsx")

administration = sim2(x = embedding_skip300fix, y = embedding_skip300fix["administration", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(administration[,1], decreasing = TRUE), 21)
administration <- sort(administration[,1], decreasing = TRUE)
administration <- as.data.frame( as.table(administration))
administration <- administration[1:50,]
write_xlsx(administration, "administration.xlsx")

political = sim2(x = embedding_skip300fix, y = embedding_skip300fix["political", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(political[,1], decreasing = TRUE), 21)
political <- sort(political[,1], decreasing = TRUE)
political <- as.data.frame( as.table(political))
political <- political[1:50,]
write_xlsx(political, "political.xlsx")

capitalist = sim2(x = embedding_skip300fix, y = embedding_skip300fix["capitalist", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(capitalist[,1], decreasing = TRUE), 21)
capitalist <- sort(capitalist[,1], decreasing = TRUE)
capitalist <- as.data.frame( as.table(capitalist))
capitalist <- capitalist[1:50,]
write_xlsx(capitalist, "capitalist.xlsx")

economic = sim2(x = embedding_skip300fix, y = embedding_skip300fix["economic", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(economic[,1], decreasing = TRUE), 21)
economic <- sort(economic[,1], decreasing = TRUE)
economic <- as.data.frame( as.table(economic))
economic <- economic[1:50,]
write_xlsx(economic, "economic.xlsx")

gift = sim2(x = embedding_skip300fix, y = embedding_skip300fix["gift", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(gift[,1], decreasing = TRUE), 21)
gift <- sort(gift[,1], decreasing = TRUE)
gift <- as.data.frame( as.table(gift))
gift <- gift[1:50,]
write_xlsx(gift, "gift.xlsx")

capitalism = sim2(x = embedding_skip300fix, y = embedding_skip300fix["capitalism", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(capitalism[,1], decreasing = TRUE), 21)
capitalism <- sort(capitalism[,1], decreasing = TRUE)
capitalism <- as.data.frame( as.table(capitalism))
capitalism <- capitalism[1:50,]
write_xlsx(capitalism, "capitalism.xlsx")
# INDIVIDUAL

individual = sim2(x = embedding_skip300fix, y = embedding_skip300fix["individual", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(individual[,1], decreasing = TRUE), 21)
individual <- sort(individual[,1], decreasing = TRUE)
individual <- as.data.frame( as.table(individual))
individual <- individual[1:50,]
write_xlsx(individual, "individual.xlsx")

individuals = sim2(x = embedding_skip300fix, y = embedding_skip300fix["individuals", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(individuals[,1], decreasing = TRUE), 21)
individuals <- sort(individuals[,1], decreasing = TRUE)
individuals <- as.data.frame( as.table(individuals))
individuals <- individuals[1:50,]
write_xlsx(individuals, "individuals.xlsx")

person = sim2(x = embedding_skip300fix, y = embedding_skip300fix["person", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(person[,1], decreasing = TRUE), 21)
person <- sort(person[,1], decreasing = TRUE)
person <- as.data.frame( as.table(person))
person <- person[1:50,]
write_xlsx(person, "person.xlsx")

collective = sim2(x = embedding_skip300fix, y = embedding_skip300fix["collective", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(collective[,1], decreasing = TRUE), 21)
collective <- sort(collective[,1], decreasing = TRUE)
collective <- as.data.frame( as.table(collective))
collective <- collective[1:50,]
write_xlsx(collective, "collective.xlsx")

level = sim2(x = embedding_skip300fix, y = embedding_skip300fix["level", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(level[,1], decreasing = TRUE), 21)
level <- sort(level[,1], decreasing = TRUE)
level <- as.data.frame( as.table(level))
level <- level[1:50,]
write_xlsx(level, "level.xlsx")

personal = sim2(x = embedding_skip300fix, y = embedding_skip300fix["personal", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(personal[,1], decreasing = TRUE), 21)
personal <- sort(personal[,1], decreasing = TRUE)
personal <- as.data.frame( as.table(personal))
personal <- personal[1:50,]
write_xlsx(personal, "personal.xlsx")

```

# SOCIOLOGY NETWORK
```{r}
#Export to excel 
library(reshape2)
library(writexl)

sociological = sim2(x = embedding_skip300fix, y = embedding_skip300fix["sociological", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(sociological[,1], decreasing = TRUE), 21)
sociological <- sort(sociological[,1], decreasing = TRUE)
sociological <- as.data.frame( as.table(sociological))
sociological <- sociological[1:50,]
write_xlsx(sociological, "sociological.xlsx")

sociology = sim2(x = embedding_skip300fix, y = embedding_skip300fix["sociology", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(sociology[,1], decreasing = TRUE), 21)
sociology <- sort(sociology[,1], decreasing = TRUE)
sociology <- as.data.frame( as.table(sociology))
sociology <- sociology[1:50,]
write_xlsx(sociology, "sociology.xlsx")

sociologist = sim2(x = embedding_skip300fix, y = embedding_skip300fix["sociologist", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(sociologist[,1], decreasing = TRUE), 21)
sociologist <- sort(sociologist[,1], decreasing = TRUE)
sociologist <- as.data.frame( as.table(sociologist))
sociologist <- sociologist[1:50,]
write_xlsx(sociologist, "sociologist.xlsx")

sociologists = sim2(x = embedding_skip300fix, y = embedding_skip300fix["sociologists", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(sociologists[,1], decreasing = TRUE), 21)
sociologists <- sort(sociologists[,1], decreasing = TRUE)
sociologists <- as.data.frame( as.table(sociologists))
sociologists <- sociologists[1:50,]
write_xlsx(sociologists, "sociologists.xlsx")

sociologys = sim2(x = embedding_skip300fix, y = embedding_skip300fix["sociologys", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(sociologys[,1], decreasing = TRUE), 21)
sociologys <- sort(sociologys[,1], decreasing = TRUE)
sociologys <- as.data.frame( as.table(sociologys))
sociologys <- sociologys[1:50,]
write_xlsx(sociologys, "sociologys.xlsx")

philosophy = sim2(x = embedding_skip300fix, y = embedding_skip300fix["philosophy", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(philosophy[,1], decreasing = TRUE), 21)
philosophy <- sort(philosophy[,1], decreasing = TRUE)
philosophy <- as.data.frame( as.table(philosophy))
philosophy <- philosophy[1:50,]
write_xlsx(philosophy, "philosophy.xlsx")

science = sim2(x = embedding_skip300fix, y = embedding_skip300fix["science", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(science[,1], decreasing = TRUE), 21)
science <- sort(science[,1], decreasing = TRUE)
science <- as.data.frame( as.table(science))
science <- science[1:50,]
write_xlsx(science, "science.xlsx")

sciences = sim2(x = embedding_skip300fix, y = embedding_skip300fix["sciences", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(sciences[,1], decreasing = TRUE), 21)
sciences <- sort(sciences[,1], decreasing = TRUE)
sciences <- as.data.frame( as.table(sciences))
sciences <- sciences[1:50,]
write_xlsx(sciences, "sciences.xlsx")

theory = sim2(x = embedding_skip300fix, y = embedding_skip300fix["theory", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(theory[,1], decreasing = TRUE), 21)
theory <- sort(theory[,1], decreasing = TRUE)
theory <- as.data.frame( as.table(theory))
theory <- theory[1:50,]
write_xlsx(theory, "theory.xlsx")

anthropology = sim2(x = embedding_skip300fix, y = embedding_skip300fix["anthropology", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(anthropology[,1], decreasing = TRUE), 21)
anthropology <- sort(anthropology[,1], decreasing = TRUE)
anthropology <- as.data.frame( as.table(anthropology))
anthropology <- anthropology[1:50,]
write_xlsx(anthropology, "anthropology.xlsx")

theories = sim2(x = embedding_skip300fix, y = embedding_skip300fix["theories", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(theories[,1], decreasing = TRUE), 21)
theories <- sort(theories[,1], decreasing = TRUE)
theories <- as.data.frame( as.table(theories))
theories <- theories[1:50,]
write_xlsx(theories, "theories.xlsx")

scientific = sim2(x = embedding_skip300fix, y = embedding_skip300fix["scientific", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(scientific[,1], decreasing = TRUE), 21)
scientific <- sort(scientific[,1], decreasing = TRUE)
scientific <- as.data.frame( as.table(scientific))
scientific <- scientific[1:50,]
write_xlsx(scientific, "scientific.xlsx")

classical = sim2(x = embedding_skip300fix, y = embedding_skip300fix["classical", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(classical[,1], decreasing = TRUE), 21)
classical <- sort(classical[,1], decreasing = TRUE)
classical <- as.data.frame( as.table(classical))
classical <- classical[1:50,]
write_xlsx(classical, "classical.xlsx")


disciplines = sim2(x = embedding_skip300fix, y = embedding_skip300fix["disciplines", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(disciplines[,1], decreasing = TRUE), 21)
disciplines <- sort(disciplines[,1], decreasing = TRUE)
disciplines <- as.data.frame( as.table(disciplines))
disciplines <- disciplines[1:50,]
write_xlsx(disciplines, "disciplines.xlsx")

tradition = sim2(x = embedding_skip300fix, y = embedding_skip300fix["tradition", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(tradition[,1], decreasing = TRUE), 21)
tradition <- sort(tradition[,1], decreasing = TRUE)
tradition <- as.data.frame( as.table(tradition))
tradition <- tradition[1:50,]
write_xlsx(tradition, "tradition.xlsx")

research = sim2(x = embedding_skip300fix, y = embedding_skip300fix["research", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(research[,1], decreasing = TRUE), 21)
research <- sort(research[,1], decreasing = TRUE)
research <- as.data.frame( as.table(research))
research <- research[1:50,]
write_xlsx(research, "research.xlsx")

economics = sim2(x = embedding_skip300fix, y = embedding_skip300fix["economics", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(economics[,1], decreasing = TRUE), 21)
economics <- sort(economics[,1], decreasing = TRUE)
economics <- as.data.frame( as.table(economics))
economics <- economics[1:50,]
write_xlsx(economics, "economics.xlsx")

philosophy = sim2(x = embedding_skip300fix, y = embedding_skip300fix["philosophy", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(philosophy[,1], decreasing = TRUE), 21)
philosophy <- sort(philosophy[,1], decreasing = TRUE)
philosophy <- as.data.frame( as.table(philosophy))
philosophy <- philosophy[1:50,]
write_xlsx(philosophy, "philosophy.xlsx")

philosophers = sim2(x = embedding_skip300fix, y = embedding_skip300fix["philosophers", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(philosophers[,1], decreasing = TRUE), 21)
philosophers <- sort(philosophers[,1], decreasing = TRUE)
philosophers <- as.data.frame( as.table(philosophers))
philosophers <- philosophers[1:50,]
write_xlsx(philosophers, "philosophers.xlsx")

positivism = sim2(x = embedding_skip300fix, y = embedding_skip300fix["positivism", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(positivism[,1], decreasing = TRUE), 21)
positivism <- sort(positivism[,1], decreasing = TRUE)
positivism <- as.data.frame( as.table(positivism))
positivism <- positivism[1:50,]
write_xlsx(positivism, "positivism.xlsx")

metaphysics = sim2(x = embedding_skip300fix, y = embedding_skip300fix["metaphysics", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(metaphysics[,1], decreasing = TRUE), 21)
metaphysics <- sort(metaphysics[,1], decreasing = TRUE)
metaphysics <- as.data.frame( as.table(metaphysics))
metaphysics <- metaphysics[1:50,]
write_xlsx(metaphysics, "metaphysics.xlsx")

contemporary = sim2(x = embedding_skip300fix, y = embedding_skip300fix["contemporary", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(contemporary[,1], decreasing = TRUE), 21)
contemporary <- sort(contemporary[,1], decreasing = TRUE)
contemporary <- as.data.frame( as.table(contemporary))
contemporary <- contemporary[1:50,]
write_xlsx(contemporary, "contemporary.xlsx")

history = sim2(x = embedding_skip300fix, y = embedding_skip300fix["history", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(history[,1], decreasing = TRUE), 21)
history <- sort(history[,1], decreasing = TRUE)
history <- as.data.frame( as.table(history))
history <- history[1:50,]
write_xlsx(history, "history.xlsx")

philosophical = sim2(x = embedding_skip300fix, y = embedding_skip300fix["philosophical", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(philosophical[,1], decreasing = TRUE), 21)
philosophical <- sort(philosophical[,1], decreasing = TRUE)
philosophical <- as.data.frame( as.table(philosophical))
philosophical <- philosophical[1:50,]
write_xlsx(philosophical, "philosophical.xlsx")

concept = sim2(x = embedding_skip300fix, y = embedding_skip300fix["concept", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(concept[,1], decreasing = TRUE), 21)
concept <- sort(concept[,1], decreasing = TRUE)
concept <- as.data.frame( as.table(concept))
concept <- concept[1:50,]
write_xlsx(concept, "concept.xlsx")

modern = sim2(x = embedding_skip300fix, y = embedding_skip300fix["modern", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(modern[,1], decreasing = TRUE), 21)
modern <- sort(modern[,1], decreasing = TRUE)
modern <- as.data.frame( as.table(modern))
modern <- modern[1:50,]
write_xlsx(modern, "modern.xlsx")

psychology = sim2(x = embedding_skip300fix, y = embedding_skip300fix["psychology", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(psychology[,1], decreasing = TRUE), 21)
psychology <- sort(psychology[,1], decreasing = TRUE)
psychology <- as.data.frame( as.table(psychology))
psychology <- psychology[1:50,]
write_xlsx(psychology, "psychology.xlsx")

approach = sim2(x = embedding_skip300fix, y = embedding_skip300fix["approach", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(approach[,1], decreasing = TRUE), 21)
approach <- sort(approach[,1], decreasing = TRUE)
approach <- as.data.frame( as.table(approach))
approach <- approach[1:50,]
write_xlsx(approach, "approach.xlsx")

studies = sim2(x = embedding_skip300fix, y = embedding_skip300fix["studies", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(studies[,1], decreasing = TRUE), 21)
studies <- sort(studies[,1], decreasing = TRUE)
studies <- as.data.frame( as.table(studies))
studies <- studies[1:50,]
write_xlsx(studies, "studies.xlsx")

scientists = sim2(x = embedding_skip300fix, y = embedding_skip300fix["scientists", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(scientists[,1], decreasing = TRUE), 21)
scientists <- sort(scientists[,1], decreasing = TRUE)
scientists <- as.data.frame( as.table(scientists))
scientists <- scientists[1:50,]
write_xlsx(scientists, "scientists.xlsx")

knowledge = sim2(x = embedding_skip300fix, y = embedding_skip300fix["knowledge", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(knowledge[,1], decreasing = TRUE), 21)
knowledge <- sort(knowledge[,1], decreasing = TRUE)
knowledge <- as.data.frame( as.table(knowledge))
knowledge <- knowledge[1:50,]
write_xlsx(knowledge, "knowledge.xlsx")

#Divisions

qualitative = sim2(x = embedding_skip300fix, y = embedding_skip300fix["qualitative", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(qualitative[,1], decreasing = TRUE), 21)
qualitative <- sort(qualitative[,1], decreasing = TRUE)
qualitative <- as.data.frame( as.table(qualitative))
qualitative <- qualitative[1:50,]
write_xlsx(qualitative, "qualitative.xlsx")

quantitative = sim2(x = embedding_skip300fix, y = embedding_skip300fix["quantitative", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(quantitative[,1], decreasing = TRUE), 21)
quantitative <- sort(quantitative[,1], decreasing = TRUE)
quantitative <- as.data.frame( as.table(quantitative))
quantitative <- quantitative[1:50,]
write_xlsx(quantitative, "quantitative.xlsx")

micro = sim2(x = embedding_skip300fix, y = embedding_skip300fix["micro", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(micro[,1], decreasing = TRUE), 21)
micro <- sort(micro[,1], decreasing = TRUE)
micro <- as.data.frame( as.table(micro))
micro <- micro[1:50,]
write_xlsx(micro, "micro.xlsx")

macro = sim2(x = embedding_skip300fix, y = embedding_skip300fix["macro", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(macro[,1], decreasing = TRUE), 21)
macro <- sort(macro[,1], decreasing = TRUE)
macro <- as.data.frame( as.table(macro))
macro <- macro[1:50,]
write_xlsx(macro, "macro.xlsx")

society = sim2(x = embedding_skip300fix, y = embedding_skip300fix["society", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(society[,1], decreasing = TRUE), 21)
society <- sort(society[,1], decreasing = TRUE)
society <- as.data.frame( as.table(society))
society <- society[1:50,]
write_xlsx(society, "society.xlsx")

emergence = sim2(x = embedding_skip300fix, y = embedding_skip300fix["emergence", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(emergence[,1], decreasing = TRUE), 21)
emergence <- sort(emergence[,1], decreasing = TRUE)
emergence <- as.data.frame( as.table(emergence))
emergence <- emergence[1:50,]
write_xlsx(emergence, "emergence.xlsx")

individual = sim2(x = embedding_skip300fix, y = embedding_skip300fix["individual", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(individual[,1], decreasing = TRUE), 21)
individual <- sort(individual[,1], decreasing = TRUE)
individual <- as.data.frame( as.table(individual))
individual <- individual[1:50,]
write_xlsx(individual, "individual.xlsx")

structure = sim2(x = embedding_skip300fix, y = embedding_skip300fix["structure", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(structure[,1], decreasing = TRUE), 21)
structure <- sort(structure[,1], decreasing = TRUE)
structure <- as.data.frame( as.table(structure))
structure <- structure[1:50,]
write_xlsx(structure, "structure.xlsx")

action = sim2(x = embedding_skip300fix, y = embedding_skip300fix["action", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(action[,1], decreasing = TRUE), 21)
action <- sort(action[,1], decreasing = TRUE)
action <- as.data.frame( as.table(action))
action <- action[1:50,]
write_xlsx(action, "action.xlsx")

culture = sim2(x = embedding_skip300fix, y = embedding_skip300fix["culture", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(culture[,1], decreasing = TRUE), 21)
culture <- sort(culture[,1], decreasing = TRUE)
culture <- as.data.frame( as.table(culture))
culture <- culture[1:50,]
write_xlsx(culture, "culture.xlsx")

science = sim2(x = embedding_skip300fix, y = embedding_skip300fix["science", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(science[,1], decreasing = TRUE), 21)
science <- sort(science[,1], decreasing = TRUE)
science <- as.data.frame( as.table(science))
science <- science[1:50,]
write_xlsx(science, "science.xlsx")

reality = sim2(x = embedding_skip300fix, y = embedding_skip300fix["reality", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(reality[,1], decreasing = TRUE), 21)
reality <- sort(reality[,1], decreasing = TRUE)
reality <- as.data.frame( as.table(reality))
reality <- reality[1:50,]
write_xlsx(reality, "reality.xlsx")

construction = sim2(x = embedding_skip300fix, y = embedding_skip300fix["construction", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(construction[,1], decreasing = TRUE), 21)
construction <- sort(construction[,1], decreasing = TRUE)
construction <- as.data.frame( as.table(construction))
construction <- construction[1:50,]
write_xlsx(construction, "construction.xlsx")

critique = sim2(x = embedding_skip300fix, y = embedding_skip300fix["critique", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(critique[,1], decreasing = TRUE), 21)
critique <- sort(critique[,1], decreasing = TRUE)
critique <- as.data.frame( as.table(critique))
critique <- critique[1:50,]
write_xlsx(critique, "critique.xlsx")

theoretical = sim2(x = embedding_skip300fix, y = embedding_skip300fix["theoretical", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(theoretical[,1], decreasing = TRUE), 21)
theoretical <- sort(theoretical[,1], decreasing = TRUE)
theoretical <- as.data.frame( as.table(theoretical))
theoretical <- theoretical[1:50,]
write_xlsx(theoretical, "theoretical.xlsx")

researchers = sim2(x = embedding_skip300fix, y = embedding_skip300fix["researchers", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(researchers[,1], decreasing = TRUE), 21)
researchers <- sort(researchers[,1], decreasing = TRUE)
researchers <- as.data.frame( as.table(researchers))
researchers <- researchers[1:50,]
write_xlsx(researchers, "researchers.xlsx")

scholars = sim2(x = embedding_skip300fix, y = embedding_skip300fix["scholars", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(scholars[,1], decreasing = TRUE), 21)
scholars <- sort(scholars[,1], decreasing = TRUE)
scholars <- as.data.frame( as.table(scholars))
scholars <- scholars[1:50,]
write_xlsx(scholars, "scholars.xlsx")

theorists = sim2(x = embedding_skip300fix, y = embedding_skip300fix["theorists", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(theorists[,1], decreasing = TRUE), 21)
theorists <- sort(theorists[,1], decreasing = TRUE)
theorists <- as.data.frame( as.table(theorists))
theorists <- theorists[1:50,]
write_xlsx(theorists, "theorists.xlsx")

humanities = sim2(x = embedding_skip300fix, y = embedding_skip300fix["humanities", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(humanities[,1], decreasing = TRUE), 21)
humanities <- sort(humanities[,1], decreasing = TRUE)
humanities <- as.data.frame( as.table(humanities))
humanities <- humanities[1:50,]
write_xlsx(humanities, "humanities.xlsx")

meso = sim2(x = embedding_skip300fix, y = embedding_skip300fix["meso", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(meso[,1], decreasing = TRUE), 21)
meso <- sort(meso[,1], decreasing = TRUE)
meso <- as.data.frame( as.table(meso))
meso <- meso[1:50,]
write_xlsx(meso, "meso.xlsx")

system = sim2(x = embedding_skip300fix, y = embedding_skip300fix["system", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(system[,1], decreasing = TRUE), 21)
system <- sort(system[,1], decreasing = TRUE)
system <- as.data.frame( as.table(system))
system <- system[1:50,]
write_xlsx(system, "system.xlsx")

interaction = sim2(x = embedding_skip300fix, y = embedding_skip300fix["interaction", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(interaction[,1], decreasing = TRUE), 21)
interaction <- sort(interaction[,1], decreasing = TRUE)
interaction <- as.data.frame( as.table(interaction))
interaction <- interaction[1:50,]
write_xlsx(interaction, "interaction.xlsx")

data = sim2(x = embedding_skip300fix, y = embedding_skip300fix["data", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(data[,1], decreasing = TRUE), 21)
data <- sort(data[,1], decreasing = TRUE)
data <- as.data.frame( as.table(data))
data <- data[1:50,]
write_xlsx(data, "data.xlsx")

empirical = sim2(x = embedding_skip300fix, y = embedding_skip300fix["empirical", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(empirical[,1], decreasing = TRUE), 21)
empirical <- sort(empirical[,1], decreasing = TRUE)
empirical <- as.data.frame( as.table(empirical))
empirical <- empirical[1:50,]
write_xlsx(empirical, "empirical.xlsx")

interpretation = sim2(x = embedding_skip300fix, y = embedding_skip300fix["interpretation", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(interpretation[,1], decreasing = TRUE), 21)
interpretation <- sort(interpretation[,1], decreasing = TRUE)
interpretation <- as.data.frame( as.table(interpretation))
interpretation <- interpretation[1:50,]
write_xlsx(interpretation, "interpretation.xlsx")

constructionism = sim2(x = embedding_skip300fix, y = embedding_skip300fix["constructionism", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(constructionism[,1], decreasing = TRUE), 21)
constructionism <- sort(constructionism[,1], decreasing = TRUE)
constructionism <- as.data.frame( as.table(constructionism))
constructionism <- constructionism[1:50,]
write_xlsx(constructionism, "constructionism.xlsx")

constructivism = sim2(x = embedding_skip300fix, y = embedding_skip300fix["constructivism", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(constructivism[,1], decreasing = TRUE), 21)
constructivism <- sort(constructivism[,1], decreasing = TRUE)
constructivism <- as.data.frame( as.table(constructivism))
constructivism <- constructivism[1:50,]
write_xlsx(constructivism, "constructivism.xlsx")

realism = sim2(x = embedding_skip300fix, y = embedding_skip300fix["realism", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(realism[,1], decreasing = TRUE), 21)
realism <- sort(realism[,1], decreasing = TRUE)
realism <- as.data.frame( as.table(realism))
realism <- realism[1:50,]
write_xlsx(realism, "realism.xlsx")

explanation = sim2(x = embedding_skip300fix, y = embedding_skip300fix["explanation", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(explanation[,1], decreasing = TRUE), 21)
explanation <- sort(explanation[,1], decreasing = TRUE)
explanation <- as.data.frame( as.table(explanation))
explanation <- explanation[1:50,]
write_xlsx(explanation, "explanation.xlsx")

objective = sim2(x = embedding_skip300fix, y = embedding_skip300fix["objective", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(objective[,1], decreasing = TRUE), 21)
objective <- sort(objective[,1], decreasing = TRUE)
objective <- as.data.frame( as.table(objective))
objective <- objective[1:50,]
write_xlsx(objective, "objective.xlsx")

subjective = sim2(x = embedding_skip300fix, y = embedding_skip300fix["subjective", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(subjective[,1], decreasing = TRUE), 21)
subjective <- sort(subjective[,1], decreasing = TRUE)
subjective <- as.data.frame( as.table(subjective))
subjective <- subjective[1:50,]
write_xlsx(subjective, "subjective.xlsx")

subjectivism = sim2(x = embedding_skip300fix, y = embedding_skip300fix["subjectivism", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(subjectivism[,1], decreasing = TRUE), 21)
subjectivism <- sort(subjectivism[,1], decreasing = TRUE)
subjectivism <- as.data.frame( as.table(subjectivism))
subjectivism <- subjectivism[1:50,]
write_xlsx(subjectivism, "subjectivism.xlsx")

objectivism = sim2(x = embedding_skip300fix, y = embedding_skip300fix["objectivism", , drop = FALSE], method = "cosine", norm = "l2")
head(sort(objectivism[,1], decreasing = TRUE), 21)
objectivism <- sort(objectivism[,1], decreasing = TRUE)
objectivism <- as.data.frame( as.table(objectivism))
objectivism <- objectivism[1:50,]
write_xlsx(objectivism, "objectivism.xlsx")

```

## Release objects and keep embedding_cbow300fix or embedding_skip300fix
```{r}
rm(embedding_cbow)
```



## Visualize the model
```{r}
# Visualize the CBOW model - 300fix
library(ggplot2)
library(uwot)
library(dplyr)
library(text2vec)

w2v_umap <- umap(embedding_cbow300fix, n_components = 2, metric = "cosine", n_neighbors = 10, min_dist = 0.1, spread=2)
dim(w2v_umap)

df_w2v_umap <- as.data.frame(w2v_umap, stringsAsFactors = FALSE)

# Add the labels of the words to the dataframe
df_w2v_umap$word <- rownames(embedding_cbow300fix)
colnames(df_w2v_umap) <- c("UMAP1", "UMAP2", "word")
df_w2v_umap$technique <- 'Word2vec CBOW - 300 dimensions of the eight-word-window of words occuring more than three times'
cat(paste0('\n', 'Our Cbow embedding reduced to 2 dimensions:', '\n'))
str(df_w2v_umap)

# Plot the UMAP dimensions for both Word2Vec and Cbow
ggplot(df_w2v_umap) +
      geom_point(aes(x = UMAP1, y = UMAP2), colour = 'darkred', size = 0.05) +
      facet_wrap(~technique) +
      labs(title = "Word embeddings of full-text corpus reduced to two dimensions (UMAP)") +
      theme_minimal() +
      theme(plot.title = element_text(hjust = .5, size = 14), axis.title.x=element_blank(), axis.title.y=element_blank())

# Plot the bottom part of the Cbow word embedding with labels
ggplot(df_w2v_umap[df_w2v_umap$UMAP1 > 7.0 & df_w2v_umap$UMAP1 < 9.0 & df_w2v_umap$UMAP2 > 2.0,]) +
      geom_point(aes(x = UMAP1, y = UMAP2), colour = 'lightslategrey', size = 2) +
      geom_text(aes(UMAP1, UMAP2, label = word), colour = 'orange4', size = 2.5, vjust=-1, hjust=0) +
      labs(title = "Cbow word embedding in 2D using UMAP - partial view") +
      theme(plot.title = element_text(hjust = .5, size = 14))

# Plot the word embedding of words that are related for the Cbow model
word <- embedding_cbow300fix["sociological", , drop = FALSE] 
cos_sim = sim2(x = embedding_cbow300fix, y = word, method = "cosine", norm = "l2")
select <- data.frame(rownames(as.data.frame(head(sort(cos_sim[,1], decreasing = TRUE), 25))))
colnames(select) <- "word"
selected_words <- df_w2v_umap %>% inner_join(y=select, by= "word", match = "all") 

# The ggplot visual for Cbow
data_glove <- ggplot(selected_words, aes(x = UMAP1, y = UMAP2, colour = word == 'sociological')) + 
      geom_point(show.legend = FALSE) + 
      scale_color_manual(values = c('lightslategrey', 'red')) +
      geom_text(aes(UMAP1, UMAP2, label = word), show.legend = FALSE, size = 2.5, vjust=-1.5, hjust=0) +
      labs(title = "Cbow word embedding of words related to 'sociological'") +
      theme(plot.title = element_text(hjust = .5, size = 13))
data_glove
```

```{r}
# Visualize the CBOW model - 300
library(ggplot2)
library(uwot)
library(dplyr)
library(text2vec)

w2v_umap <- umap(embedding_cbow300, n_components = 2, metric = "cosine", n_neighbors = 25, min_dist = 0.1, spread=2)
dim(w2v_umap)

df_w2v_umap <- as.data.frame(w2v_umap, stringsAsFactors = FALSE)

# Add the labels of the words to the dataframe
df_w2v_umap$word <- rownames(embedding_cbow300)
colnames(df_w2v_umap) <- c("UMAP1", "UMAP2", "word")
df_w2v_umap$technique <- 'Cbow'
cat(paste0('\n', 'CBOW 300 embedding reduced to 2 dimensions:', '\n'))
str(df_w2v_umap)

# Plot the UMAP dimensions for both Word2Vec and Cbow
ggplot(df_w2v_umap) +
      geom_point(aes(x = UMAP1, y = UMAP2), colour = 'turquoise4', size = 0.05) +
      facet_wrap(~technique) +
      labs(title = "CBOW 300 embedding in 2D using UMAP") +
      theme(plot.title = element_text(hjust = .5, size = 14))

# Plot the bottom part of the Cbow word embedding with labels
ggplot(df_w2v_umap[df_w2v_umap$UMAP1 > 1.0 & df_w2v_umap$UMAP1 < 3.0 & df_w2v_umap$UMAP2 > 2.0,]) +
      geom_point(aes(x = UMAP1, y = UMAP2), colour = 'lightslategrey', size = 2) +
      geom_text(aes(UMAP1, UMAP2, label = word), colour = 'orange4', size = 2.5, vjust=-1, hjust=0) +
      labs(title = "CBOW 300 embedding in 2D using UMAP - partial view") +
      theme(plot.title = element_text(hjust = .5, size = 14))

# Plot the word embedding of words that are related for the Cbow model
word <- embedding_cbow300["sociology", , drop = FALSE] 
cos_sim = sim2(x = embedding_cbow300, y = word, method = "cosine", norm = "l2")
select <- data.frame(rownames(as.data.frame(head(sort(cos_sim[,1], decreasing = TRUE), 25))))
colnames(select) <- "word"
selected_words <- df_w2v_umap %>% inner_join(y=select, by= "word", match = "all") 

# The ggplot visual for Cbow
data_glove <- ggplot(selected_words, aes(x = UMAP1, y = UMAP2, colour = word == 'sociology')) + 
      geom_point(show.legend = FALSE) + 
      scale_color_manual(values = c('lightslategrey', 'red')) +
      geom_text(aes(UMAP1, UMAP2, label = word), show.legend = FALSE, size = 2.5, vjust=-1.5, hjust=0) +
      labs(title = "CBOW 300 embedding of words related to 'sociology'") +
      theme(plot.title = element_text(hjust = .5, size = 13))
data_glove
```

```{r}
# Visualize the skip gram model 300
library(ggplot2)
library(uwot)
library(dplyr)
library(text2vec)

w2v_umap <- umap(embedding_skip300fix, n_components = 2, metric = "cosine", n_neighbors = 25, min_dist = 0.1, spread=2)
dim(w2v_umap)

df_w2v_umap <- as.data.frame(w2v_umap, stringsAsFactors = FALSE)

# Add the labels of the words to the dataframe
df_w2v_umap$word <- rownames(embedding_skip300fix)
colnames(df_w2v_umap) <- c("UMAP1", "UMAP2", "word")
df_w2v_umap$technique <- 'Word2vec skip-gram - 300 dimensions of the eight-word-window of words occuring more than three times'
cat(paste0('\n', 'Word2vec skip-gram - 300 dimensions of the eight-word-window of words occuring more than three times', '\n'))
str(df_w2v_umap)

# Plot the UMAP dimensions for both Word2Vec and GloVe
ggplot(df_w2v_umap) +
      geom_point(aes(x = UMAP1, y = UMAP2), colour = 'darkred', size = 0.05) +
      facet_wrap(~technique) +
      labs(title = "Word embeddings of full-text corpus reduced to two dimensions (UMAP)") +
      theme_minimal() +
      theme(plot.title = element_text(hjust = .5, size = 14), axis.title.x=element_blank(), axis.title.y=element_blank())

# Plot the bottom part of the Skip gram word embedding with labels
ggplot(df_w2v_umap[df_w2v_umap$UMAP1 > 1.0 & df_w2v_umap$UMAP1 < 3.0 & df_w2v_umap$UMAP2 > 2.0,]) +
      geom_point(aes(x = UMAP1, y = UMAP2), colour = 'lightslategrey', size = 2) +
      geom_text(aes(UMAP1, UMAP2, label = word), colour = 'orange4', size = 2.5, vjust=-1, hjust=0) +
      labs(title = "Skip-gram 300 embedding in 2D using UMAP - partial view") +
      theme(plot.title = element_text(hjust = .5, size = 14))

# Plot the word embedding of words that are related for the Skip gram model
word <- embedding_skip300fix["knowledge", , drop = FALSE] 
cos_sim = sim2(x = embedding_skip300fix, y = word, method = "cosine", norm = "l2")
select <- data.frame(rownames(as.data.frame(head(sort(cos_sim[,1], decreasing = TRUE), 20))))
colnames(select) <- "word"
selected_words <- df_w2v_umap %>% inner_join(y=select, by= "word", match = "all") 

# The ggplot visual for Skip gram
data_glove <- ggplot(selected_words, aes(x = UMAP1, y = UMAP2, colour = word == 'knowledge')) + 
      geom_point(show.legend = FALSE) + 
      scale_color_manual(values = c('lightslategrey', 'red')) +
      geom_text(aes(UMAP1, UMAP2, label = word), show.legend = FALSE, size = 2.5, vjust=-1.5, hjust=0) +
      labs(title = "Skip-gram 300 embedding of words related to 'sociology'") +
      theme(plot.title = element_text(hjust = .5, size = 13))
data_glove
```

```{r}
# Visualize the GloVe model
library(ggplot2)
library(uwot)
library(dplyr)
library(text2vec)

glove_umap <- umap(glove_embedding300, n_components = 2, metric = "cosine", n_neighbors = 25, min_dist = 0.1, spread=2)
dim(glove_umap)

df_glove_umap <- as.data.frame(glove_umap, stringsAsFactors = FALSE)

# Add the labels of the words to the dataframe
df_glove_umap$word <- rownames(glove_embedding300)
colnames(df_glove_umap) <- c("UMAP1", "UMAP2", "word")
df_glove_umap$technique <- 'GloVe'
cat(paste0('\n', 'Our GloVe embedding reduced to 2 dimensions:', '\n'))
str(df_glove_umap)

# Plot the UMAP dimensions for both Word2Vec and GloVe
ggplot(df_glove_umap) +
      geom_point(aes(x = UMAP1, y = UMAP2), colour = 'turquoise4', size = 0.05) +
      facet_wrap(~technique) +
      labs(title = "Word embedding in 2D using UMAP") +
      theme(plot.title = element_text(hjust = .5, size = 14))

# Plot the bottom part of the GloVe word embedding with labels
ggplot(df_glove_umap[df_glove_umap$UMAP1 > 7.5 & df_glove_umap$UMAP1 < 8.0 & df_glove_umap$UMAP2 > 0.0,]) +
      geom_point(aes(x = UMAP1, y = UMAP2), colour = 'lightslategrey', size = 2) +
      geom_text(aes(UMAP1, UMAP2, label = word), colour = 'orange4', size = 2.5, vjust=-1, hjust=0) +
      labs(title = "GloVe word embedding in 2D using UMAP - partial view") +
      theme(plot.title = element_text(hjust = .5, size = 14))

# Plot the word embedding of words that are related for the GloVe model
word <- glove_embedding300["sociology", , drop = FALSE] 
cos_sim = sim2(x = glove_embedding300, y = word, method = "cosine", norm = "l2")
select <- data.frame(rownames(as.data.frame(head(sort(cos_sim[,1], decreasing = TRUE), 25))))
colnames(select) <- "word"
selected_words <- df_glove_umap %>% inner_join(y=select, by= "word", match = "all") 

# The ggplot visual for GloVe
data_glove <- ggplot(selected_words, aes(x = UMAP1, y = UMAP2, colour = word == 'sociology')) + 
      geom_point(show.legend = FALSE) + 
      scale_color_manual(values = c('lightslategrey', 'red')) +
      geom_text(aes(UMAP1, UMAP2, label = word), show.legend = FALSE, size = 2.5, vjust=-1.5, hjust=0) +
      labs(title = "GloVe word embedding of words related to 'sociology'") +
      theme(plot.title = element_text(hjust = .5, size = 13))
data_glove
```
```{r}
# Visualize the conText GloVe model
library(ggplot2)
library(uwot)
library(dplyr)
library(text2vec)

glove_umap <- umap(local_glove, n_components = 2, metric = "cosine", n_neighbors = 25, min_dist = 0.1, spread=2)
dim(glove_umap)

df_glove_umap <- as.data.frame(glove_umap, stringsAsFactors = FALSE)

# Add the labels of the words to the dataframe
df_glove_umap$word <- rownames(local_glove)
colnames(df_glove_umap) <- c("UMAP1", "UMAP2", "word")
df_glove_umap$technique <- 'GloVe'
cat(paste0('\n', 'Our GloVe embedding reduced to 2 dimensions:', '\n'))
str(df_glove_umap)

# Plot the UMAP dimensions for both Word2Vec and GloVe
ggplot(df_glove_umap) +
      geom_point(aes(x = UMAP1, y = UMAP2), colour = 'turquoise4', size = 0.05) +
      facet_wrap(~technique) +
      labs(title = "Word embedding in 2D using UMAP") +
      theme(plot.title = element_text(hjust = .5, size = 14))

# Plot the bottom part of the GloVe word embedding with labels
ggplot(df_glove_umap[df_glove_umap$UMAP1 > -4.0 & df_glove_umap$UMAP1 < -2.0 & df_glove_umap$UMAP2 > -1.0,]) +
      geom_point(aes(x = UMAP1, y = UMAP2), colour = 'lightslategrey', size = 2) +
      geom_text(aes(UMAP1, UMAP2, label = word), colour = 'orange4', size = 2.5, vjust=-1, hjust=0) +
      labs(title = "GloVe word embedding in 2D using UMAP - partial view") +
      theme(plot.title = element_text(hjust = .5, size = 14))

# Plot the word embedding of words that are related for the GloVe model
word <- local_glove["sociology", , drop = FALSE] 
cos_sim = sim2(x = local_glove, y = word, method = "cosine", norm = "l2")
select <- data.frame(rownames(as.data.frame(head(sort(cos_sim[,1], decreasing = TRUE), 25))))
colnames(select) <- "word"
selected_words <- df_glove_umap %>% inner_join(y=select, by= "word", match = "all") 

# The ggplot visual for GloVe
data_glove <- ggplot(selected_words, aes(x = UMAP1, y = UMAP2, colour = word == 'sociology')) + 
      geom_point(show.legend = FALSE) + 
      scale_color_manual(values = c('lightslategrey', 'red')) +
      geom_text(aes(UMAP1, UMAP2, label = word), show.legend = FALSE, size = 2.5, vjust=-1.5, hjust=0) +
      labs(title = "GloVe word embedding of words related to 'sociology'") +
      theme(plot.title = element_text(hjust = .5, size = 13))
data_glove
```

# Put the results side-by-side for a comparison
```{r}
library(gridExtra)
grid_glove <- grid.arrange(class_glove,knowledge_glove,discourse_glove,health_glove, ncol=2)
plot(grid_glove)

```

## Concept Movers Distance
```{r}
library(text2vec)
library(text2map)
library(tidyr)

# stylo dfs
my.df <- select(tidy_allmain_stylo, modularity_class, text) #with modularity class
my.dtm <- dtm_builder(my.df, text, modularity_class)
my.dtm = my.dtm[-c(318),]

# different dfs
my.df <- select(tidy_allmain, id, text) #with id
my.dtm <- dtm_builder(my.df, text, id)
my.dtm = my.dtm[-c(318),]

my.df <- select(tidy_allmain, uni, text) #with uni
my.df <- subset(my.df, uni != "OTHER")
my.dtm <- dtm_builder(my.df, text, uni)

my.df <- select(tidy_allmain, year, text) #with year
my.dtm <- dtm_builder(my.df, text, year)
my.dtm = my.dtm[-c(318),]

my.df <- select(tidy_allmain, gender, text) #with gender
my.dtm <- dtm_builder(my.df, text, gender)
my.dtm = my.dtm[-c(318),]

my.df <- select(tidy_allmain, disstype, text) #with disstype
my.dtm <- dtm_builder(my.df, text, disstype)
my.dtm = my.dtm[-c(318),]

my.df <- select(tidy_allmain, language, text) #with language
my.dtm <- dtm_builder(my.df, text, language)
my.dtm = my.dtm[-c(318),]


#import word vectors 
my.wv <- embedding_cbow #CBOW 50
my.wv <- embedding_skip #skip gram 50
my.wv <- glove_embedding #GloVe 50
my.wv <- glove_embedding300 #GloVe 300
my.wv <- embedding_cbow300 #CBOW 300
my.wv <- embedding_skip300 #skip-gram 300
my.wv <- embedding_cbow300fix #CBOW 300 fix
my.wv <- embedding_skip300fix #skip-gram 300 fix
my.wv <- local_glove #Glove conText version

#Terms Denoting Focal Concepts
cos.sim.concept <- sim2(x = embedding_skip300fix, y = embedding_skip300fix["sociology", , drop = FALSE], method = "cosine")
head(sort(cos.sim.concept[,1], decreasing = TRUE), 10)

# doc distance to single (or multiple) concept
concept.words <- c("quantitative")
doc.closeness <- CMDist(dtm = my.dtm, cw = concept.words, wv = my.wv, scale = TRUE)
head(sort(doc.closeness[,2], decreasing =TRUE), 10)

doc.closeness.order <- doc.closeness[order(doc.closeness$mead) , ]
doc.closeness.order

## Semantic Directions (poles)
additions  <- c("survey", "surveys", "questionnaire", "questionnaires", "census", "statistics", "statistical") # build semantic direction:
subtracts <- c("interview", "interviews", "ethnography", "ethnographic", "fieldwork", "observation", "observations")

additions <- "quantitative"
subtracts <- "qualitative"

additions <- c("quantitative", "fact", "analyse", "analyze", "analysis", "analyses", "realism", "structure", "structural", "individual", "individuals", "cause", "causal")
subtracts <- c("qualitative", "interpret", "interpreting", "interpretation", "interpretations", "narrative", "narratives", "construct", "construction", "culture", "cultural", "emergence", "emergent")

additions <- c("quantitative", "fact", "analyse", "analyze", "analysis", "analyses", "realism", "structure", "structural", "individual", "individuals", "cause", "causal", "survey", "surveys", "questionnaire", "questionnaires", "census", "statistics", "statistical")
subtracts <- c("qualitative", "interpret", "interpreting", "interpretation", "interpretations", "narrative", "narratives", "construct", "construction", "culture", "cultural", "emergence", "emergent", "interview", "interviews", "ethnography", "ethnographic", "fieldwork", "discourse", "discourses")

pairs <- cbind(additions, subtracts)
additions.sd <- get_direction(pairs, my.wv)
doc.closeness <- CMDist(dtm = my.dtm, cv = additions.sd, wv = my.wv) # input it into the function just like a concept word

doc.closeness.order <- doc.closeness[order(doc.closeness$quantitative_pole) , ]


## Semantic Centriod
classic  <- c("comte","weber", "durkheim", "marx", "engels", "simmel", "mead", "cooley", "spencer", "tnnies") # first build the semantic centroid:
classic <- get_centroid(classic, my.wv)
doc.closeness <- CMDist(dtm = my.dtm, cv = classic, wv = my.wv) # input it into the function just like a concept word


soc_centroid  <- c("sociology","sociological", "sociologies", "sociologys") # first build the semantic centroid:
soc_centroid <- get_centroid(soc_centroid, my.wv)
doc.closeness <- CMDist(dtm = my.dtm, cv = soc_centroid, wv = my.wv) # input it into the function just like a concept word

```

# Plot
```{r}
## Plot point
ggplot(data = doc.closeness, aes(x = doc_id, y = survey_pole)) +
  geom_point() +
  stat_summary(
    geom = "bar",
    fun.y = "mean",
    col = "black",
    size = 3,
    shape = 24,
    fill = "red"
  )

ggplot(doc.closeness, aes(x=doc_id)) + 
  geom_point(aes(y = health), color = "darkred") + 
  geom_point(aes(y = survey), color="steelblue") +
  geom_point(aes(y = knowledge), color="darkgreen")

e <- ggplot(doc.closeness, aes(x = doc_id, y = quantitative_pole))
e +  geom_jitter(aes(color = doc_id, shape = doc_id),position=position_jitter(0.2)) +
  scale_x_discrete(limits=c("SU", "UmU", "GU", "LU", "UU", "OTHER")) +
  scale_fill_brewer(palette="Dark2") +
  theme(legend.position="bottom")

e <- ggplot(doc.closeness, aes(x = doc_id, y = quantitative_pole))
e +  geom_line(aes(color = doc_id, shape = doc_id))

# Box plot
ggplot(doc.closeness, aes(x=doc_id, y=comte_centroid, fill=doc_id)) +
  geom_boxplot(outlier.shape = NA) +
  scale_y_continuous(limits = c(-3, 3)) +
  scale_fill_brewer(palette="Accent") +
  scale_x_discrete(limits=c("SU", "UmU", "GU", "LU", "UU")) +
  theme_minimal() +
  theme(legend.position="none", axis.title.x = element_blank(), axis.title.y = element_blank()) +
  labs(title = "Semantic poles of quantitative and qualitative terms")

ggplot(doc.closeness, aes(x=doc_id, y=survey_pole, fill=doc_id)) +
  geom_boxplot(outlier.shape = NA) +
  scale_y_continuous(limits = c(-3, 3)) +
  theme(legend.position="none") +
  labs(title = "GloVe word embeddings")

# Violine plot
qplot(doc_id, quantitative_pole, data = doc.closeness, geom = "violin") +
  scale_x_discrete(limits=c("SU", "UmU", "GU", "LU", "UU")) +
  labs(title = "CBOW, Abbott+method")

qplot(doc_id, comte_centroid, data = doc.closeness, geom = "dotplot",
      stackdir = "center", binaxis = "y", dotsize = 0.5) +
  labs(title = "Text2vec, cbow")

# histogram and area
qplot(quantitative_pole, data = doc.closeness, geom = "histogram",
      fill = doc_id)

qplot(quantitative_pole, data = doc.closeness, geom = "density",
    color = doc_id, linetype = doc_id) +
    labs(title = "GloVe word embeddings")

ggplot(doc.closeness, aes(x = quantitative_pole, fill = doc_id)) +
            geom_density(alpha=0.4) +
            scale_fill_brewer(palette="Set1") +
            labs(title = "GloVe word embeddings")

## valuable information fomr the analysis
my.df[[318,1]] # "2015 KA Vadelius eng mono W me.txt.txt" is a hyper-qualitative outlier
```

